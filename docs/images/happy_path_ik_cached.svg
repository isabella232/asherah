<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="577" height="532" contentScriptType="application/ecmascript" contentStyleType="text/css" preserveAspectRatio="none" style="width:577px;height:532px" version="1.1" viewBox="0 0 577 532" zoomAndPan="magnify"><g><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="35" x2="35" y1="65.29" y2="339.175"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="158.5" x2="158.5" y1="65.29" y2="339.175"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="412" x2="412" y1="65.29" y2="339.175"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="489" x2="489" y1="65.29" y2="339.175"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="553" x2="553" y1="65.29" y2="339.175"/><rect width="54" height="30.29" x="8" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="34"/><text x="15" y="54.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40">Caller</text><rect width="54" height="30.29" x="8" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="338.175"/><text x="15" y="358.478" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40">Caller</text><text x="127.5" y="62.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57">Asherah</text><path fill="none" d="M138.5,21 L138.5,45 M138.5,33 L155.5,33" style="stroke:#a80036;stroke-width:2"/><ellipse cx="167.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><text x="127.5" y="351.478" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57">Asherah</text><path fill="none" d="M138.5,358.4653 L138.5,382.4653 M138.5,370.4653 L155.5,370.4653" style="stroke:#a80036;stroke-width:2"/><ellipse cx="167.5" cy="370.465" fill="#FEFECE" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><rect width="56" height="30.29" x="386" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="30"/><rect width="56" height="30.29" x="382" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="34"/><text x="389" y="54.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42">Cache</text><rect width="56" height="30.29" x="386" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="338.175"/><rect width="56" height="30.29" x="382" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="342.175"/><text x="389" y="362.478" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42">Cache</text><text x="452" y="62.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68">Metastore</text><path fill="#FEFECE" d="M471,13 C471,3 489,3 489,3 C489,3 507,3 507,13 L507,39 C507,49 489,49 489,49 C489,49 471,49 471,39 L471,13" style="stroke:#000;stroke-width:1.5"/><path fill="none" d="M471,13 C471,23 489,23 489,23 C489,23 507,23 507,13" style="stroke:#000;stroke-width:1.5"/><text x="452" y="351.478" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68">Metastore</text><path fill="#FEFECE" d="M471,364.4653 C471,354.4653 489,354.4653 489,354.4653 C489,354.4653 507,354.4653 507,364.4653 L507,390.4653 C507,400.4653 489,400.4653 489,400.4653 C489,400.4653 471,400.4653 471,390.4653 L471,364.4653" style="stroke:#000;stroke-width:1.5"/><path fill="none" d="M471,364.4653 C471,374.4653 489,374.4653 489,374.4653 C489,374.4653 507,374.4653 507,364.4653" style="stroke:#000;stroke-width:1.5"/><text x="536" y="62.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29">KMS</text><ellipse cx="553.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><line style="stroke:#a80036;stroke-width:2" x1="541.5" x2="565.5" y1="47" y2="47"/><text x="536" y="351.478" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29">KMS</text><ellipse cx="553.5" cy="370.465" fill="#FEFECE" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><line style="stroke:#a80036;stroke-width:2" x1="541.5" x2="565.5" y1="384.465" y2="384.465"/><polygon fill="#A80036" points="147 92.416 157 96.416 147 100.416 151 96.416" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="35" x2="153" y1="96.416" y2="96.416"/><text x="42" y="91.643" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100">encrypt payload</text><polygon fill="#A80036" points="400 121.543 410 125.543 400 129.543 404 125.543" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="159" x2="406" y1="125.543" y2="125.543"/><text x="166" y="120.769" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229">get IK from protected memory cache</text><line style="stroke:#a80036;stroke-width:1" x1="159" x2="201" y1="179.669" y2="179.669"/><line style="stroke:#a80036;stroke-width:1" x1="201" x2="201" y1="179.669" y2="192.669"/><line style="stroke:#a80036;stroke-width:1" x1="160" x2="201" y1="192.669" y2="192.669"/><polygon fill="#A80036" points="170 188.669 160 192.669 170 196.669 166 192.669" style="stroke:#a80036;stroke-width:1"/><text x="166" y="174.895" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217">generate DRK and encrypt using IK</text><line style="stroke:#a80036;stroke-width:1" x1="159" x2="201" y1="221.796" y2="221.796"/><line style="stroke:#a80036;stroke-width:1" x1="201" x2="201" y1="221.796" y2="234.796"/><line style="stroke:#a80036;stroke-width:1" x1="160" x2="201" y1="234.796" y2="234.796"/><polygon fill="#A80036" points="170 230.796 160 234.796 170 238.796 166 234.796" style="stroke:#a80036;stroke-width:1"/><text x="166" y="217.022" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173">use DRK to encrypt payload</text><line style="stroke:#a80036;stroke-width:1" x1="159" x2="201" y1="279.049" y2="279.049"/><line style="stroke:#a80036;stroke-width:1" x1="201" x2="201" y1="279.049" y2="292.049"/><line style="stroke:#a80036;stroke-width:1" x1="160" x2="201" y1="292.049" y2="292.049"/><polygon fill="#A80036" points="170 288.049 160 292.049 170 296.049 166 292.049" style="stroke:#a80036;stroke-width:1"/><text x="166" y="259.148" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171">package encrypted payload</text><text x="166" y="274.275" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180">with encrypted DRK in a DRR</text><polygon fill="#A80036" points="46 317.175 36 321.175 46 325.175 42 321.175" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="40" x2="158" y1="321.175" y2="321.175"/><text x="52" y="316.401" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68">return DRR</text><rect width="301" height="111.74" x="11" y="409.465" fill="#DDD" rx="5" ry="5" style="stroke:#000;stroke-width:1"/><text x="22" y="429.802" fill="#000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35">Type</text><text x="67" y="429.802" fill="#000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83">Description</text><text x="21" y="446.058" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21">MK</text><text x="66" y="446.058" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="208">Master Key, root key from KMS</text><text x="21" y="462.348" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17">SK</text><text x="66" y="462.348" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="197">System Key, encrypted by MK</text><text x="21" y="478.638" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="13">IK</text><text x="66" y="478.638" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="232">Intermediate Key, encrypted by SK</text><text x="21" y="494.928" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28">DRK</text><text x="66" y="494.928" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="205">Data Row Key, encrypted by IK</text><text x="21" y="511.218" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28">DRR</text><text x="66" y="511.218" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="236">encrypted data and encrypted DRK</text><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="416.465" y2="416.465"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="432.755" y2="432.755"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="449.045" y2="449.045"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="465.335" y2="465.335"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="481.625" y2="481.625"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="497.916" y2="497.916"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="514.206" y2="514.206"/><line style="stroke:#000;stroke-width:1" x1="17" x2="17" y1="416.465" y2="514.206"/><line style="stroke:#000;stroke-width:1" x1="62" x2="62" y1="416.465" y2="514.206"/><line style="stroke:#000;stroke-width:1" x1="306" x2="306" y1="416.465" y2="514.206"/></g></svg>