<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="585" height="782" contentScriptType="application/ecmascript" contentStyleType="text/css" preserveAspectRatio="none" style="width:585px;height:782px" version="1.1" viewBox="0 0 585 782" zoomAndPan="magnify"><g><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="35" x2="35" y1="65.29" y2="589.934"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="158.5" x2="158.5" y1="65.29" y2="589.934"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="420" x2="420" y1="65.29" y2="589.934"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="497" x2="497" y1="65.29" y2="589.934"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="561" x2="561" y1="65.29" y2="589.934"/><rect width="54" height="30.29" x="8" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="34"/><text x="15" y="54.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40">Caller</text><rect width="54" height="30.29" x="8" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="588.934"/><text x="15" y="609.237" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40">Caller</text><text x="127.5" y="62.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57">Asherah</text><path fill="none" d="M138.5,21 L138.5,45 M138.5,33 L155.5,33" style="stroke:#a80036;stroke-width:2"/><ellipse cx="167.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><text x="127.5" y="602.237" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57">Asherah</text><path fill="none" d="M138.5,609.2241 L138.5,633.2241 M138.5,621.2241 L155.5,621.2241" style="stroke:#a80036;stroke-width:2"/><ellipse cx="167.5" cy="621.224" fill="#FEFECE" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><rect width="56" height="30.29" x="394" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="30"/><rect width="56" height="30.29" x="390" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="34"/><text x="397" y="54.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42">Cache</text><rect width="56" height="30.29" x="394" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="588.934"/><rect width="56" height="30.29" x="390" fill="#FEFECE" style="stroke:#a80036;stroke-width:1.5" y="592.934"/><text x="397" y="613.237" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42">Cache</text><text x="460" y="62.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68">Metastore</text><path fill="#FEFECE" d="M479,13 C479,3 497,3 497,3 C497,3 515,3 515,13 L515,39 C515,49 497,49 497,49 C497,49 479,49 479,39 L479,13" style="stroke:#000;stroke-width:1.5"/><path fill="none" d="M479,13 C479,23 497,23 497,23 C497,23 515,23 515,13" style="stroke:#000;stroke-width:1.5"/><text x="460" y="602.237" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68">Metastore</text><path fill="#FEFECE" d="M479,615.2241 C479,605.2241 497,605.2241 497,605.2241 C497,605.2241 515,605.2241 515,615.2241 L515,641.2241 C515,651.2241 497,651.2241 497,651.2241 C497,651.2241 479,651.2241 479,641.2241 L479,615.2241" style="stroke:#000;stroke-width:1.5"/><path fill="none" d="M479,615.2241 C479,625.2241 497,625.2241 497,625.2241 C497,625.2241 515,625.2241 515,615.2241" style="stroke:#000;stroke-width:1.5"/><text x="544" y="62.303" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29">KMS</text><ellipse cx="561.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><line style="stroke:#a80036;stroke-width:2" x1="549.5" x2="573.5" y1="47" y2="47"/><text x="544" y="602.237" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29">KMS</text><ellipse cx="561.5" cy="621.224" fill="#FEFECE" rx="12" ry="12" style="stroke:#a80036;stroke-width:2"/><line style="stroke:#a80036;stroke-width:2" x1="549.5" x2="573.5" y1="635.224" y2="635.224"/><polygon fill="#A80036" points="147 92.416 157 96.416 147 100.416 151 96.416" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="35" x2="153" y1="96.416" y2="96.416"/><text x="42" y="91.643" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100">encrypt payload</text><polygon fill="#A80036" points="549.5 121.543 559.5 125.543 549.5 129.543 553.5 125.543" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="159" x2="555.5" y1="125.543" y2="125.543"/><text x="166" y="120.769" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173">generate data key using MK</text><line style="stroke:#a80036;stroke-width:1" x1="159" x2="201" y1="179.669" y2="179.669"/><line style="stroke:#a80036;stroke-width:1" x1="201" x2="201" y1="179.669" y2="192.669"/><line style="stroke:#a80036;stroke-width:1" x1="160" x2="201" y1="192.669" y2="192.669"/><polygon fill="#A80036" points="170 188.669 160 192.669 170 196.669 166 192.669" style="stroke:#a80036;stroke-width:1"/><text x="166" y="174.895" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247">generate SK and encrypt using data key</text><polygon fill="#A80036" points="485 217.796 495 221.796 485 225.796 489 221.796" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="159" x2="491" y1="221.796" y2="221.796"/><text x="166" y="217.022" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128">persist encrypted SK</text><polygon fill="#A80036" points="408 246.922 418 250.922 408 254.922 412 250.922" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="159" x2="414" y1="250.922" y2="250.922"/><text x="166" y="246.148" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190">cache SK in protected memory</text><line style="stroke:#a80036;stroke-width:1" x1="159" x2="201" y1="305.049" y2="305.049"/><line style="stroke:#a80036;stroke-width:1" x1="201" x2="201" y1="305.049" y2="318.049"/><line style="stroke:#a80036;stroke-width:1" x1="160" x2="201" y1="318.049" y2="318.049"/><polygon fill="#A80036" points="170 314.049 160 318.049 170 322.049 166 318.049" style="stroke:#a80036;stroke-width:1"/><text x="166" y="300.275" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="206">generate IK and encrypt using SK</text><polygon fill="#A80036" points="485 343.175 495 347.175 485 351.175 489 347.175" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="159" x2="491" y1="347.175" y2="347.175"/><text x="166" y="342.401" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125">persist encrypted IK</text><polygon fill="#A80036" points="408 372.302 418 376.302 408 380.302 412 376.302" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="159" x2="414" y1="376.302" y2="376.302"/><text x="166" y="371.528" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187">cache IK in protected memory</text><line style="stroke:#a80036;stroke-width:1" x1="159" x2="201" y1="430.428" y2="430.428"/><line style="stroke:#a80036;stroke-width:1" x1="201" x2="201" y1="430.428" y2="443.428"/><line style="stroke:#a80036;stroke-width:1" x1="160" x2="201" y1="443.428" y2="443.428"/><polygon fill="#A80036" points="170 439.428 160 443.428 170 447.428 166 443.428" style="stroke:#a80036;stroke-width:1"/><text x="166" y="425.654" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217">generate DRK and encrypt using IK</text><line style="stroke:#a80036;stroke-width:1" x1="159" x2="201" y1="472.555" y2="472.555"/><line style="stroke:#a80036;stroke-width:1" x1="201" x2="201" y1="472.555" y2="485.555"/><line style="stroke:#a80036;stroke-width:1" x1="160" x2="201" y1="485.555" y2="485.555"/><polygon fill="#A80036" points="170 481.555 160 485.555 170 489.555 166 485.555" style="stroke:#a80036;stroke-width:1"/><text x="166" y="467.781" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173">use DRK to encrypt payload</text><line style="stroke:#a80036;stroke-width:1" x1="159" x2="201" y1="529.808" y2="529.808"/><line style="stroke:#a80036;stroke-width:1" x1="201" x2="201" y1="529.808" y2="542.808"/><line style="stroke:#a80036;stroke-width:1" x1="160" x2="201" y1="542.808" y2="542.808"/><polygon fill="#A80036" points="170 538.808 160 542.808 170 546.808 166 542.808" style="stroke:#a80036;stroke-width:1"/><text x="166" y="509.907" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171">package encrypted payload</text><text x="166" y="525.034" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180">with encrypted DRK in a DRR</text><polygon fill="#A80036" points="46 567.934 36 571.934 46 575.934 42 571.934" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="40" x2="158" y1="571.934" y2="571.934"/><text x="52" y="567.16" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68">return DRR</text><rect width="301" height="111.74" x="11" y="660.224" fill="#DDD" rx="5" ry="5" style="stroke:#000;stroke-width:1"/><text x="22" y="680.561" fill="#000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35">Type</text><text x="67" y="680.561" fill="#000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83">Description</text><text x="21" y="696.817" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21">MK</text><text x="66" y="696.817" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="208">Master Key, root key from KMS</text><text x="21" y="713.107" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17">SK</text><text x="66" y="713.107" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="197">System Key, encrypted by MK</text><text x="21" y="729.397" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="13">IK</text><text x="66" y="729.397" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="232">Intermediate Key, encrypted by SK</text><text x="21" y="745.687" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28">DRK</text><text x="66" y="745.687" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="205">Data Row Key, encrypted by IK</text><text x="21" y="761.977" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28">DRR</text><text x="66" y="761.977" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="236">encrypted data and encrypted DRK</text><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="667.224" y2="667.224"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="683.514" y2="683.514"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="699.804" y2="699.804"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="716.094" y2="716.094"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="732.384" y2="732.384"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="748.674" y2="748.674"/><line style="stroke:#000;stroke-width:1" x1="17" x2="306" y1="764.964" y2="764.964"/><line style="stroke:#000;stroke-width:1" x1="17" x2="17" y1="667.224" y2="764.964"/><line style="stroke:#000;stroke-width:1" x1="62" x2="62" y1="667.224" y2="764.964"/><line style="stroke:#000;stroke-width:1" x1="306" x2="306" y1="667.224" y2="764.964"/></g></svg>